<html>
    <head>
        <title>Shopping Cart</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
        <script>
            function loadXMLDoc(filename) {
                var xhttp = new XMLHttpRequest();
                xhttp.open("GET", filename, false);
                xhttp.send("");
                return xhttp.responseXML;
            }

            function displayResult() {
                var xml = loadXMLDoc("data.xml");
                
                if (xml) {
                    try {
                        var xmlDoc = xml;   
                        console.log(xmlDoc);

                        var orders = xmlDoc.getElementsByTagName("Order");
                        var cartHtml = "<ul>";
                        for (var i = 0; i < orders.length; i++) {
                            cartHtml += "<li>" + 
                                "<h2>" + orders[i].getElementsByTagName("Singer")[0].textContent + "</h2>" +
                                orders[i].getElementsByTagName("AlbumName")[0].textContent + "<br>" + 
                                "<image src='" + orders[i].getElementsByTagName("AlbumImageURL")[0].textContent + "' width='300px'>" + "<br>" +
                                "<h2>" + orders[i].getElementsByTagName("AlbumPrice")[0].textContent + "</h2>" +
                                "</li>";
                        }
                        cartHtml += "</ul>";

                        document.getElementById("xmllist").innerHTML = cartHtml;

                    } catch (e) {
                        console.error("Error during XSLT processing:", e);
                    }
                } else {
                    // console.error("Failed to load XML.");
                }
            }


            function init() {
                displayResult();
            }

            function viewsrc() {
                alert(document.body.innerHTML);
            }

            function addInstance() {
                var formHtml = "<h2>新增專輯</h2>" +
                            "<form id='newOrderForm'>" +
                            "<label for='singer'>Singer:</label><br>" +
                            "<input type='text' id='singer' name='singer'><br>" +
                            "<label for='albumName'>Album Name:</label><br>" +
                            "<input type='text' id='albumName' name='albumName'><br>" +
                            "<label for='albumPrice'>Album Price:</label><br>" +
                            "<input type='text' id='albumPrice' name='albumPrice'><br>" +
                            "<label for='albumImageUrl'>Album Image URL:</label><br>" +
                            "<input type='text' id='albumImageUrl' name='albumImageUrl'><br>" +
                            "<input type='button' value='新增' onclick='submitNewAlbum();'><br>" +
                            "</form>";
                document.getElementById("xform").innerHTML = formHtml;
            }

            function submitNewAlbum() {
                var xml2 = loadXMLDoc("output.xml");
                
                if (xml2) {
                    try {
                            var xmlDoc2 = xml2;

                    } catch (e) {
                        console.error("Error during XSLT processing:", e);
                    }
                } else {
                    // console.error("Failed to load XML.");
                }
                // Here you would collect the form data
                // and add it to your XML. This requires further JavaScript logic.
                // However, without a server-side backend or JavaScript XML manipulation,
                // the new order cannot be permanently added to 'data.xml'.
            }

            function deleteInstance() {
                
            }
        </script>
    </head>
    <body onload="init();">
        <header>
            <nav>
                <ul>
                    <li><a href="../xml_viewer/index.html">XML Viewer</a></li>
                    <li><a href="index.html">XML Generator</a></li>
                </ul>
            </nav>
        </header>
        <div id="xslhead"></div>
        <hr>
        <button onclick="addInstance();">新增專輯</button>
        <button onclick="deleteInstance();">刪除專輯</button>
        <button onclick="viewsrc();">檢視原始檔</button>
        <div id="others">
            <button><a href="data.xml">原始資料 (xml)</a></button>
        </div>
        <hr>
        <div id="xform"></div>
        <div id="xmllist"></div>
        <footer>
            <p>GitHub <a href="https://github.com/chihyu0917">@chihyu0917</p>
        </footer>
    </body>
</html>
